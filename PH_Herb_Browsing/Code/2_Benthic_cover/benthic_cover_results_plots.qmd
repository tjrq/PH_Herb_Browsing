---
title: "benthic_cover_results_plots"
format: html
editor: visual
---

# CORAL COVER

## summary table

```{r}
coral_mod |> as_draws_df() |> 
  dplyr::select(matches("^b_.*")) |>
  exp() |> 
  summarise_draws(median,
                  HDInterval::hdi,
                  Pl= ~mean(.x < 1),
                  Pg = ~mean(.x > 1))
```

## check coral values

```{r}
coral_mod |> 
emmeans(~ Depth_band,
        type = "link") |> 
  gather_emmeans_draws() |> 
  mutate(prob = plogis(.value),
         percentage = prob * 100) |> 
  dplyr::select(-.chain,
                -.iteration,
                -.draw,
                -.value) |> 
  summarise_draws(median,
                  HDInterval::hdi,
                  Pl = ~mean(.x < 1),
                  Pg = ~mean(.x > 1)) |> 
  filter(variable == "percentage")
```


## plot coral and depth band

```{r}
p_coral <- 
coral_mod |> 
emmeans(~ Depth_band,
        type = "link") |> 
  gather_emmeans_draws() |> 
  mutate(prob = plogis(.value),
         percentage = prob * 100) |> 
  dplyr::select(-.chain,
                -.iteration,
                -.draw,
                -.value) |> 
  summarise_draws(median,
                  HDInterval::hdi,
                  Pl = ~mean(.x < 1),
                  Pg = ~mean(.x > 1)) |> 
  filter(variable == "percentage") |> 
  ggplot(aes(x = Depth_band,
             y = median)) +
  geom_pointrange(aes(ymin = lower, 
                      ymax = upper),
                  position = position_dodge(0.25),
                  shape = 21,
                  size = 1,
                  fatten = 3,
                  color = "#8AA17D",
                  fill = "#8AA17D") +
  scale_y_continuous(limits = c(0,80),
                     breaks = seq(0, 80, by = 20),
                     expression(Percentage~cover)) +
  theme_classic() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        plot.title = element_text(size = 18),
        axis.text.y = element_text(size = 12),
        axis.title = element_text(size = 15)) +
  theme(legend.position = "none") +
  ggtitle("Coral") +
  geom_image(data = tibble(Depth_band = 4.2,
                           median = 74),
             aes(image = "acropora-spp.png"),
             size = 0.30)
```

## pairwise table

```{r}
#coral_mod_pairs <- 
coral_mod |> 
emmeans(~ Depth_band,
        type = "link") |>
  pairs() |> 
  gather_emmeans_draws() |> # log-odds ratio
  mutate(.value = exp(.value)) |>    
  summarise(median_hdci(.value),
            Pl = mean(.value < 1),
            Pg = mean(.value > 1))#,
            #.width = c(0.85, 0.95))
```

# MACROALGAE COVER

## summary table

```{r}
ma_mod |> as_draws_df() |> 
  dplyr::select(matches("^b_.*")) |>
  exp() |> 
  summarise_draws(median,
                  HDInterval::hdi,
                  Pl= ~mean(.x < 1),
                  Pg = ~mean(.x > 1))
```

## check macroalgae values

```{r}
ma_mod |> 
emmeans(~ Depth_band,
        type = "link") |> 
  gather_emmeans_draws() |> 
  mutate(prob = plogis(.value),
         percentage = prob * 100) |> 
  dplyr::select(-.chain,
                -.iteration,
                -.draw,
                -.value) |> 
  summarise_draws(median,
                  HDInterval::hdi,
                  Pl = ~mean(.x < 1),
                  Pg = ~mean(.x > 1)) |> 
  filter(variable == "percentage")
```


## plot macroalgae and depth band

```{r}
p_macroalgae <- 
ma_mod |> 
emmeans(~ Depth_band,
        type = "link") |> 
  gather_emmeans_draws() |> 
  mutate(prob = plogis(.value),
         percentage = prob * 100) |> 
  dplyr::select(-.chain,
                -.iteration,
                -.draw,
                -.value) |> 
  summarise_draws(median,
                  HDInterval::hdi,
                  Pl = ~mean(.x < 1),
                  Pg = ~mean(.x > 1)) |> 
  filter(variable == "percentage") |> 
  ggplot(aes(x = Depth_band,
             y = median)) +
  geom_pointrange(aes(ymin = lower, 
                      ymax = upper),
                  position = position_dodge(0.25),
                  shape = 21,
                  size = 1,
                  fatten = 3,
                  color = "#DDD487",
                  fill = "#DDD487") +
  scale_y_continuous(limits = c(0,80),
                     breaks = seq(0, 80, by = 20),
                     expression(Percentage~cover)) +
  theme_classic() +
  theme(
        plot.title = element_text(size = 18),
        axis.text = element_text(size = 12),
        axis.title = element_text(size = 15)) +
  scale_x_discrete(name = "Depth band") +
  theme(legend.position = "none") +
  ggtitle("Macroalgae") +
  geom_image(data = tibble(Depth_band = 4.2,
                           median = 64),
             aes(image = "sargassum-spp.png"),
             size = 0.30)
```

## pairwise table

```{r}
#coral_mod_pairs <- 
ma_mod |> 
emmeans(~ Depth_band,
        type = "link") |>
  pairs() |> 
  gather_emmeans_draws() |> # odds-ratio
  mutate(.value = exp(.value)) |> # log odds-ratio  
  summarise(median_hdci(.value),
            Pl = mean(.value < 1),
            Pg = mean(.value > 1))#,
            #.width = c(0.85, 0.95))
```

# COMBINE BENTHIC PLOTS

```{r}
p_benthic <-
p_coral /
p_macroalgae +
  plot_annotation(tag_levels = "a") &
  theme(plot.tag = element_text(size = 15))
```

## ggsave

```{r}
ggsave("Fig. 2. coral_macroalgae.jpeg",
       plot =p_benthic, 
       dpi = 600, 
       height = 8, 
       width = 8, 
       units = "in")
```

# TOTAL ALGAE COVER: looks like macroalgae is driving this pattern so not gonna display it in the results

s \## summary tableaa

```{r}
ta_mod |> as_draws_df() |> 
  dplyr::select(matches("^b_.*")) |>
  exp() |> 
  summarise_draws(median,
                  HDInterval::hdi,
                  Pl= ~mean(.x < 1),
                  Pg = ~mean(.x > 1))
```

## plot total algae and depth band

```{r}
#p_total_algae <- 
ta_mod |> 
emmeans(~ Depth_band,
        type = "link") |> 
  gather_emmeans_draws() |> 
  mutate(prob = plogis(.value),
         percentage = prob * 100) |> 
  dplyr::select(-.chain,
                -.iteration,
                -.draw,
                -.value) |> 
  summarise_draws(median,
                  HDInterval::hdi,
                  Pl = ~mean(.x < 1),
                  Pg = ~mean(.x > 1)) |> 
  filter(variable == "percentage") |> 
  ggplot(aes(x = Depth_band,
             y = median)) +
  geom_pointrange(aes(ymin = lower, 
                      ymax = upper),
                  position = position_dodge(0.25),
                  shape = 21,
                  size = 1,
                  fatten = 3,
                  color = "#929FBD",
                  fill = "#929FBD") +
  scale_y_continuous(limits = c(0,80),
                     breaks = seq(0, 80, by = 20),
                     expression(Percentage~cover)) +
  theme_classic() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        plot.title = element_text(size = 18),
        axis.text.y = element_text(size = 12),
        axis.title = element_text(size = 15)) +
  theme(legend.position = "none") +
  ggtitle("Total algae") #+
  #geom_image(data = tibble(Depth_band = 4.2,
   #                        median = 64),
    #         aes(image = "sargassum-spp.png"),
     #        size = 0.30)
```
